{"version":3,"file":"GitChangelog-CsL-dNIZ.js","sources":["../../src/client/options.ts","../../src/client/utils/resolveRepoLink.ts","../../src/client/composables/useChangelog.ts","../../src/client/composables/useLastUpdated.ts","../../src/client/components/GitChangelog.ts"],"sourcesContent":["import type { GitInjectOptions } from '../shared/index.js'\n\ndeclare const __GIT_OPTIONS__: GitInjectOptions\n\nexport const gitOptions = __GIT_OPTIONS__\n","import { isLinkHttp } from '@vuepress/helper/client'\nimport type { KnownGitProvider } from '../../shared/index.js'\n\nexport const resolveRepoLink = (\n  link?: string,\n  provider?: KnownGitProvider | null,\n): string | undefined => {\n  if (!link || isLinkHttp(link)) return link\n\n  if (provider === 'github') return `https://github.com/${link}`\n\n  if (provider === 'gitee') return `https://gitee.com/${link}`\n\n  return link\n}\n","import type { ComputedRef } from 'vue'\nimport { computed } from 'vue'\nimport { usePageData, usePageFrontmatter, usePageLang } from 'vuepress/client'\nimport type {\n  GitChangelogInfo,\n  GitPluginFrontmatter,\n  GitPluginPageData,\n} from '../../shared/index.js'\nimport { gitOptions } from '../options.js'\nimport { resolveRepoLink } from '../utils/index.js'\n\nexport interface GitChangelogItem extends GitChangelogInfo {\n  date: string\n}\n\nconst RE_ISSUE = /#(\\d+)/g\n\nexport const useChangelog = (): ComputedRef<GitChangelogItem[]> => {\n  const frontmatter = usePageFrontmatter<GitPluginFrontmatter>()\n  const lang = usePageLang()\n  const page = usePageData<GitPluginPageData>()\n\n  const { pattern = {}, provider } = gitOptions\n  const repo = resolveRepoLink(gitOptions.repo, provider)\n\n  return computed(() => {\n    if (frontmatter.value.changelog === false) return []\n\n    const formatter = new Intl.DateTimeFormat(lang.value, {\n      dateStyle: 'short',\n    })\n\n    // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n    return (page.value.git?.changelog ?? []).map((item) => {\n      const res: GitChangelogItem = {\n        date: formatter.format(item.time),\n        ...item,\n      }\n\n      if (pattern.issue && repo) {\n        res.message = res.message.replace(\n          RE_ISSUE,\n          (matched, issue: string) => {\n            const url = pattern\n              .issue!.replace(':issue', issue)\n              .replace(':repo', repo)\n            return `<a href=\"${url}\" target=\"_blank\" rel=\"noopener noreferrer\">${matched}</a>`\n          },\n        )\n      }\n\n      if (pattern.commit && repo) {\n        res.commitUrl = pattern.commit\n          .replace(':hash', res.hash)\n          .replace(':repo', repo)\n      }\n\n      if (pattern.tag && repo && res.tag)\n        res.tagUrl = pattern.tag.replace(':tag', res.tag).replace(':repo', repo)\n\n      return res\n    })\n  })\n}\n","import type { ComputedRef } from 'vue'\nimport { computed } from 'vue'\nimport { usePageData, usePageLang } from 'vuepress/client'\nimport type { GitPluginPageData } from '../../shared/index.js'\nimport { useGitLocaleConfig } from './useGitLocales.js'\n\nexport interface LastUpdated {\n  date: Date\n  iso: string\n  text: string\n}\n\nexport const useLastUpdated = (): ComputedRef<LastUpdated | null> => {\n  const lang = usePageLang()\n  const locale = useGitLocaleConfig()\n  const page = usePageData<GitPluginPageData>()\n\n  return computed(() => {\n    const timeStamp =\n      // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n      page.value.git?.updatedTime ?? page.value.git?.changelog?.[0].time\n\n    if (!timeStamp) return null\n\n    const date = new Date(timeStamp)\n\n    const formatted = new Intl.DateTimeFormat(lang.value, {\n      dateStyle: 'short',\n      timeStyle: 'short',\n    }).format(timeStamp)\n\n    return {\n      date,\n      iso: date.toISOString(),\n      text: `${locale.value.latestUpdateAt} ${formatted}`,\n    }\n  })\n}\n","import { useToggle } from '@vueuse/core'\nimport type { FunctionalComponent } from 'vue'\nimport { defineComponent, h } from 'vue'\nimport type { GitChangelogItem } from '../composables/index.js'\nimport {\n  useChangelog,\n  useGitLocaleConfig,\n  useLastUpdated,\n} from '../composables/index.js'\nimport { VPHeader } from './VPHeader.js'\n\nimport '../styles/vars.css'\nimport '../styles/changelog.css'\n\nexport const GitChangelog = defineComponent({\n  name: 'GitChangelog',\n\n  props: {\n    /** Title of changelog */\n    title: String,\n\n    /** header level of changelog */\n    headerLevel: {\n      type: Number,\n      default: 2,\n    },\n  },\n\n  setup(props) {\n    const changelog = useChangelog()\n    const locale = useGitLocaleConfig()\n    const latestUpdated = useLastUpdated()\n\n    const [active, toggleActive] = useToggle()\n\n    const ChangelogHeader: FunctionalComponent = () =>\n      h(\n        'div',\n        { class: 'vp-changelog-header', onClick: () => toggleActive() },\n        [\n          h('div', { class: 'vp-latest-updated' }, [\n            h('span', { class: 'vp-changelog-icon' }),\n            h('span', { 'data-allow-mismatch': '' }, latestUpdated.value!.text),\n          ]),\n          h('div', [\n            h('span', { class: 'vp-changelog-menu-icon' }),\n            h('span', locale.value.viewChangelog),\n          ]),\n        ],\n      )\n\n    const ReleaseTag: FunctionalComponent<{ item: GitChangelogItem }> = ({\n      item,\n    }) =>\n      h(\n        'li',\n        { class: 'vp-changelog-item-tag' },\n        h('div', [\n          h('a', { class: 'vp-changelog-tag' }, h('code', item.tag)),\n          h(\n            'span',\n            { 'class': 'vp-changelog-date', 'data-allow-mismatch': '' },\n            [\n              locale.value.timeOn,\n              ' ',\n              h(\n                'time',\n                { datetime: new Date(item.time).toISOString() },\n                item.date,\n              ),\n            ],\n          ),\n        ]),\n      )\n\n    const Commit: FunctionalComponent<{ item: GitChangelogItem }> = ({\n      item,\n    }) =>\n      h('li', { class: 'vp-changelog-item-commit' }, [\n        h(\n          item.commitUrl ? 'a' : 'span',\n          {\n            class: 'vp-changelog-hash',\n            href: item.commitUrl,\n            target: '_blank',\n            rel: 'noreferrer',\n          },\n          [h('code', item.hash.slice(0, 5))],\n        ),\n        h('span', { class: 'vp-changelog-divider' }, '-'),\n        h('span', { class: 'vp-changelog-message', innerHTML: item.message }),\n        h('span', { 'class': 'vp-changelog-date', 'data-allow-mismatch': '' }, [\n          locale.value.timeOn || 'on',\n          ' ',\n          h('time', { datetime: new Date(item.time).toISOString() }, item.date),\n        ]),\n      ])\n\n    return () =>\n      changelog.value.length\n        ? [\n            h(VPHeader, {\n              level: props.headerLevel,\n              anchor: 'doc-changelog',\n              text: props.title || locale.value.changelog,\n            }),\n\n            h(\n              'div',\n              { class: ['vp-changelog-wrapper', { active: active.value }] },\n              [\n                h(ChangelogHeader),\n\n                h('ul', { class: 'vp-changelog-list' }, [\n                  changelog.value.map((item) =>\n                    item.tag\n                      ? h(ReleaseTag, { item, key: item.tag })\n                      : h(Commit, { item, key: item.hash }),\n                  ),\n                ]),\n              ],\n            ),\n          ]\n        : null\n  },\n})\n"],"names":["gitOptions","resolveRepoLink","link","provider","isLinkHttp","RE_ISSUE","useChangelog","frontmatter","usePageFrontmatter","lang","usePageLang","page","usePageData","pattern","repo","computed","formatter","item","res","matched","issue","useLastUpdated","locale","useGitLocaleConfig","timeStamp","date","formatted","GitChangelog","defineComponent","props","changelog","latestUpdated","active","toggleActive","useToggle","ChangelogHeader","h","ReleaseTag","Commit","VPHeader"],"mappings":"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"}